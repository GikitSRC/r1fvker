<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      text-align: center;
      background-color: black;
      color: white;
      font-family: monospace;
    }
    .container {
      padding: 15px;
      border-radius: 25px;
      background-color: rgba(40, 40, 40, 0.7);
      height: 60%;
      margin-top: 15%;
      width: 80%;
      margin-left: 10%;
    }
    textarea {
      border-radius: 25px;
      background-color: rgba(45, 45, 45, 0.8);
      border: 1px solid transparent;
      text-align: center;
      color: white;
      font-family: monospace;
    }
    button {
      background-color: rgba(45, 45, 45, 0.8);
      border-radius: 25px;
      border: 1px solid transparent;
      color: white;
      font-family: monospace;
      padding: 5px;
      margin-top: 5px;
      cursor: pointer;
      transition: all 0.3s;
      width: 35%;
    }
    button:hover {
      transform: scale(1.1);
    }
  </style>
<title>R1 Fvker</title>
</head>
<body>
  <div class="container">
  <h1>R1 fvker</h1>
  <textarea id="message" rows="4" cols="50" placeholder="Type your message here"></textarea>
    <br>
  <button onclick="sendMessage()">Send</button>

  <p>Response Text:</p>
  <div id="responseText"></div>

  <button onclick="playAudio()">Play Audio</button><br>
  </div>

  <script>
    const socket = new WebSocket('wss://r1-api.rabbit.tech/session');

    socket.onopen = () => {
      console.log('WebSocket connection opened');
      
      // Send authorization payload
      const authPayload = {
        "global": {
          "initialize": {
            "deviceId": "358240051111110",
            "evaluate": false,
            "greet": true,
            "language": "en",
            "listening": true,
            "mimeType": "wav",
            "timeZone": "America/Los_Angeles",
            "token": "rabbit-account-key+9f22b4de044f8eeb819fe96b8f6299aa"
          }
        }
      };
      socket.send(JSON.stringify(authPayload));
    };

    socket.onmessage = (event) => {
      console.log('Message received:', event.data);
      const response = JSON.parse(event.data);
      if (response && response.kernel && response.kernel.assistantResponseDevice) {
        const responseText = JSON.parse(response.kernel.assistantResponseDevice.text);
        document.getElementById('responseText').innerText = responseText.chars.join('');
        if (response.kernel.assistantResponseDevice.audio) {
          const audioData = response.kernel.assistantResponseDevice.audio.split(',')[1];
          const audioPlayer = document.getElementById('audioPlayer');
          audioPlayer.src = 'data:audio/wav;base64,' + audioData;
          audioPlayer.load(); // Load the audio file
          audioPlayer.style.display = 'inline-block'; // Show the audio player
        } else {
          document.getElementById('audioPlayer').style.display = 'none';
        }
      }
    };

    socket.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

    socket.onclose = () => {
      console.log('WebSocket connection closed');
    };

    function sendMessage() {
      const messageInput = document.getElementById('message').value.trim();
      if (messageInput === '') {
        alert('Please enter a message.');
        return;
      }

      // Construct message payload
      const userTextPayload = {
        "kernel": {
          "userText": {
            "text": messageInput
          }
        }
      };

      // Send message payload
      socket.send(JSON.stringify(userTextPayload));
    }

    function playAudio() {
      document.getElementById('audioPlayer').play();
    }
  </script>
</body>
</html>
